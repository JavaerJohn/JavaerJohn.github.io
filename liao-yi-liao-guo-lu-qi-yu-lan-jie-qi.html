<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="èŠä¸€èŠè¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨, æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="è¿‡æ»¤å™¨ Filter
é¢è¯•å®˜ï¼šç”¨è¿‡è¿‡æ»¤å™¨å§ï¼Œä»‹ç»ä¸€ä¸‹è¿‡æ»¤å™¨ã€‚JohnåŒå­¦ï¼ˆå¿ƒä¸­çªƒå–œï¼‰ï¼šç”¨è¿‡ï¼Œæˆ‘ç»å¸¸ç”¨å®ƒæ¥å‡€åŒ–æ°´ ğŸ˜â€¦é¢è¯•å®˜ï¼šä»Šå¤©çš„é¢è¯•åˆ°æ­¤ç»“æŸï¼Œå›å»ç­‰é€šçŸ¥å§ã€‚JohnåŒå­¦ï¼šğŸ™ƒâ€¦

Filter åŸºæœ¬ä»‹ç»è¿‡æ»¤å™¨ Filter æ˜¯ Sun ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>èŠä¸€èŠè¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨ | John&#39;s Blog</title>

    <!-- <link rel="icon" href="#">  --> 
    <link rel="icon" type="image/png" href="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/hexo/favicon.png">


    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?4d1d73af45a62734730491a6b6c41da4";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
   </script>


  
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

    <meta name="baidu-site-verification" content>




<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">John's Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fas fa-home"></i>
            
            <span>é¦–é¡µ</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fas fa-tags"></i>
            
            <span>æ ‡ç­¾</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fas fa-bookmark"></i>
            
            <span>åˆ†ç±»</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fas fa-user-circle"></i>
            
            <span>å…³äº</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fas fa-address-book"></i>
            
            <span>å‹æƒ…é“¾æ¥</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fas fa-comments"></i>
            
            <span>ç•™è¨€æ¿</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="æœç´¢"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">John's Blog</div>
        <div class="logo-desc">
            
            ä¸€åæ­£åœ¨åŠªåŠ›çš„ç¨‹åºå‘˜
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fas fa-home"></i>
                
                é¦–é¡µ
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fas fa-tags"></i>
                
                æ ‡ç­¾
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fas fa-bookmark"></i>
                
                åˆ†ç±»
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fas fa-user-circle"></i>
                
                å…³äº
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fas fa-address-book"></i>
                
                å‹æƒ…é“¾æ¥
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fas fa-comments"></i>
                
                ç•™è¨€æ¿
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JavaerJohn" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JavaerJohn" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('è¯·è¾“å…¥è®¿é—®æœ¬æ–‡ç« çš„å¯†ç ')).toString(CryptoJS.enc.Hex)) {
                alert('å¯†ç é”™è¯¯ï¼Œå°†è¿”å›ä¸»é¡µï¼');
                location.href = '/';
            }
        }
    })();
</script>




<!-- <div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/74.jpg')"> -->
<div class="bg-cover pd-header post-cover">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="center-align post-title">
                        èŠä¸€èŠè¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/Java/" target="_blank">
                            <span class="chip bg-color">Java</span>
                        </a>
                        
                        <a href="/tags/Web/" target="_blank">
                            <span class="chip bg-color">Web</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/æŠ€æœ¯å­¦ä¹ /" class="post-category" target="_blank">
                            æŠ€æœ¯å­¦ä¹ 
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2022-05-11
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>ä½œè€…:&nbsp;&nbsp;
                    
                    JohnåŒå­¦
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    6.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    24 åˆ†
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="è¿‡æ»¤å™¨-Filter"><a href="#è¿‡æ»¤å™¨-Filter" class="headerlink" title="è¿‡æ»¤å™¨ Filter"></a>è¿‡æ»¤å™¨ Filter</h2><blockquote>
<p>é¢è¯•å®˜ï¼šç”¨è¿‡è¿‡æ»¤å™¨å§ï¼Œä»‹ç»ä¸€ä¸‹è¿‡æ»¤å™¨ã€‚<br>JohnåŒå­¦ï¼ˆå¿ƒä¸­çªƒå–œï¼‰ï¼šç”¨è¿‡ï¼Œæˆ‘ç»å¸¸ç”¨å®ƒæ¥å‡€åŒ–æ°´ ğŸ˜â€¦<br>é¢è¯•å®˜ï¼šä»Šå¤©çš„é¢è¯•åˆ°æ­¤ç»“æŸï¼Œå›å»ç­‰é€šçŸ¥å§ã€‚<br>JohnåŒå­¦ï¼šğŸ™ƒâ€¦</p>
</blockquote>
<h3 id="Filter-åŸºæœ¬ä»‹ç»"><a href="#Filter-åŸºæœ¬ä»‹ç»" class="headerlink" title="Filter åŸºæœ¬ä»‹ç»"></a>Filter åŸºæœ¬ä»‹ç»</h3><p>è¿‡æ»¤å™¨ Filter æ˜¯ Sun å…¬å¸åœ¨ Servlet 2.3 è§„èŒƒä¸­æ·»åŠ çš„æ–°åŠŸèƒ½ï¼Œå…¶ä½œç”¨æ˜¯å¯¹å®¢æˆ·ç«¯å‘é€ç»™ Servlet çš„è¯·æ±‚ä»¥åŠå¯¹ Servlet è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”åšä¸€äº›å®šåˆ¶åŒ–çš„å¤„ç†ï¼Œä¾‹å¦‚æ ¡éªŒè¯·æ±‚çš„å‚æ•°ã€è®¾ç½®è¯·æ±‚/å“åº”çš„ Headerã€ä¿®æ”¹è¯·æ±‚/å“åº”çš„å†…å®¹ç­‰ã€‚</p>
<p>Filter å¼•å…¥äº†è¿‡æ»¤é“¾ï¼ˆFilter Chainï¼‰çš„æ¦‚å¿µï¼Œä¸€ä¸ª Web åº”ç”¨å¯ä»¥éƒ¨ç½²å¤šä¸ª Filterï¼Œè¿™äº› Filter ä¼šç»„æˆä¸€ç§é“¾å¼ç»“æ„ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨åˆ°è¾¾ Servlet ä¹‹å‰ä¼šä¸€ç›´åœ¨è¿™ä¸ªé“¾ä¸Šä¼ é€’ï¼Œä¸åŒçš„ Filter è´Ÿè´£å¯¹è¯·æ±‚/å“åº”åšä¸åŒçš„å¤„ç†ã€‚ Filter çš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/Filter%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82.jpg" alt></p>
<p>Filter çš„ä½œç”¨å¯è®¤ä¸ºæ˜¯å¯¹ Servlet åŠŸèƒ½çš„å¢å¼ºï¼Œå› ä¸º Filter å¯ä»¥å¯¹ç”¨æˆ·çš„è¯·æ±‚åšé¢„å¤„ç†ï¼Œä¹Ÿå¯ä»¥å¯¹è¿”å›çš„å“åº”åšåå¤„ç†ï¼Œä¸”è¿™äº›å¤„ç†é€»è¾‘ä¸ Servlet çš„å¤„ç†é€»è¾‘æ˜¯åˆ†éš”å¼€çš„ï¼Œè¿™ä½¿å¾—ç¨‹åºä¸­å„éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h3 id="åˆ›å»º-Filter"><a href="#åˆ›å»º-Filter" class="headerlink" title="åˆ›å»º Filter"></a>åˆ›å»º Filter</h3><p>åˆ›å»º Filter éœ€è¦å®ç° javax.servlet.Filter æ¥å£ï¼Œæˆ–è€…ç»§æ‰¿å®ç°äº† Filter æ¥å£çš„çˆ¶ç±»ã€‚Filter æ¥å£ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><p>initï¼šåœ¨ Web ç¨‹åºå¯åŠ¨æ—¶è¢«è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ– Filterã€‚</p>
</li>
<li><p>doFilterï¼šåœ¨å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾æ—¶è¢«è°ƒç”¨ï¼ŒdoFilter æ–¹æ³•ä¸­å®šä¹‰äº† Filter çš„ä¸»è¦å¤„ç†é€»è¾‘ï¼ŒåŒæ—¶è¯¥æ–¹æ³•è¿˜è´Ÿè´£å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ª Filter æˆ– Servletã€‚</p>
</li>
<li><p>destroyï¼šåœ¨ Web ç¨‹åºå…³é—­æ—¶è¢«è°ƒç”¨ï¼Œç”¨äºé”€æ¯ä¸€äº›èµ„æºã€‚</p>
</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å®ç° Filter æ¥å£æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Filterï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>FilterConfig filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>filterConfig<span class="token punctuation">.</span><span class="token function">getFilterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" è¢«åˆå§‹åŒ–"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span>ServletRequest servletRequest<span class="token punctuation">,</span> ServletResponse servletResponse<span class="token punctuation">,</span> FilterChain filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>
        HttpServletRequest request <span class="token operator">=</span> <span class="token punctuation">(</span>HttpServletRequest<span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter æ‹¦æˆªåˆ°äº†è¯·æ±‚: "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter å¯¹è¯·æ±‚åšé¢„å¤„ç†..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter ä¿®æ”¹å“åº”çš„å†…å®¹..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter è¢«å›æ”¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>init æ–¹æ³•çš„ filterConfig å‚æ•°å°è£…äº†å½“å‰ Filter çš„é…ç½®ä¿¡æ¯ï¼Œåœ¨ Filter åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å°† Filter çš„åç§°æ‰“å°åœ¨æ§åˆ¶å°ã€‚</p>
</li>
<li><p>doFilter æ–¹æ³•å®šä¹‰äº† Filter æ‹¦æˆªåˆ°ç”¨æˆ·è¯·æ±‚åçš„å¤„ç†é€»è¾‘ï¼Œ<code>filterChain.doFilter(servletRequest, servletResponse);</code> æŒ‡çš„æ˜¯å°†è¯·æ±‚ä¼ é€’ç»™ä¸€ä¸‹ä¸ª Filter æˆ– Servletï¼Œå¦‚æœä¸æ·»åŠ è¯¥è¯­å¥ï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¸ä¼šå‘åä¼ é€’ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šè¢«å¤„ç†ã€‚åœ¨è¯¥è¯­å¥ä¹‹åï¼Œå¯ä»¥æ·»åŠ å¯¹å“åº”çš„å¤„ç†é€»è¾‘ï¼ˆå¦‚æœè¦ä¿®æ”¹å“åº”çš„ Headerï¼Œå¯ç›´æ¥åœ¨è¯¥è¯­å¥ä¹‹å‰ä¿®æ”¹ï¼›å¦‚æœè¦ä¿®æ”¹å“åº”çš„å†…å®¹ï¼Œåˆ™éœ€è¦åœ¨è¯¥è¯­å¥ä¹‹åï¼Œä¸”éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª responseï¼‰ã€‚</p>
</li>
<li><p>destroy æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¾“å‡º â€œFilter è¢«å›æ”¶â€ çš„æç¤ºä¿¡æ¯ã€‚</p>
</li>
</ul>
<h3 id="é…ç½®-Filter"><a href="#é…ç½®-Filter" class="headerlink" title="é…ç½® Filter"></a>é…ç½® Filter</h3><p>Spring é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@Configuration + @Bean + FilterRegistrationBean</code> å¯¹ Filter è¿›è¡Œé…ç½®ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> FilterRegistrationBean<span class="token operator">&lt;</span>TestFilter<span class="token operator">></span> <span class="token function">registryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        FilterRegistrationBean<span class="token operator">&lt;</span>TestFilter<span class="token operator">></span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">addUrlPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"TestFilter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒsetFilter æ–¹æ³•ç”¨äºè®¾ç½® Filter çš„ç±»å‹ï¼›addUrlPatterns æ–¹æ³•ç”¨äºè®¾ç½®æ‹¦æˆªçš„è§„åˆ™ï¼›setName æ–¹æ³•ç”¨äºè®¾ç½® Filter çš„åç§°ï¼›setOrder æ–¹æ³•ç”¨äºè®¾ç½® Filter çš„ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p>
<h3 id="æµ‹è¯•-Filter"><a href="#æµ‹è¯•-Filter" class="headerlink" title="æµ‹è¯• Filter"></a>æµ‹è¯• Filter</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡ï¼Œæµ‹è¯• Filter æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/hello"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨å¤„ç†è¯·æ±‚..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯·æ±‚å¤„ç†å®Œæˆ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"I'm fine, thank you."</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯åŠ¨é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>localhost:8080/hello</code>ï¼Œç­‰å¾…è¯·æ±‚å¤„ç†å®Œæˆï¼Œç„¶åå…³é—­é¡¹ç›®ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶å°ä¾æ¬¡æ‰“å°äº†å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/TestFilter.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè‡ªå®šä¹‰çš„ TestFilter å®ç°äº†æ‹¦æˆªè¯·æ±‚ã€å¤„ç†å“åº”çš„ç›®æ ‡ã€‚</p>
<h3 id="åˆ›å»º-Filter-çš„å…¶å®ƒæ–¹å¼"><a href="#åˆ›å»º-Filter-çš„å…¶å®ƒæ–¹å¼" class="headerlink" title="åˆ›å»º Filter çš„å…¶å®ƒæ–¹å¼"></a>åˆ›å»º Filter çš„å…¶å®ƒæ–¹å¼</h3><p><strong>1. @WebFilter æ³¨è§£ + åŒ…æ‰«æ</strong></p>
<p>é™¤äº† FilterRegistrationBean å¤–ï¼ŒServlet 3.0 å¼•å…¥çš„æ³¨è§£ @WebFilter ä¹Ÿå¯ç”¨äºé…ç½® Filterã€‚æˆ‘ä»¬åªéœ€è¦åœ¨è‡ªå®šä¹‰çš„ Filter ç±»ä¸Šæ·»åŠ è¯¥æ³¨è§£ï¼Œå°±å¯ä»¥è®¾ç½® Filter çš„åç§°å’Œæ‹¦æˆªè§„åˆ™ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">"/*"</span><span class="token punctuation">,</span> filterName <span class="token operator">=</span> <span class="token string">"TestFilter"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”±äº@WebFilter å¹¶é Spring æä¾›ï¼Œå› æ­¤è‹¥è¦ä½¿è‡ªå®šä¹‰çš„ Filter ç”Ÿæ•ˆï¼Œè¿˜éœ€åœ¨é…ç½®ç±»ä¸Šæ·»åŠ  @ServletComponetScan æ³¨è§£ï¼Œå¹¶æŒ‡å®šæ‰«æçš„åŒ…ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ServletComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.example.filter"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>DemoApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>@WebFilter æ³¨è§£å¹¶ä¸å…è®¸æˆ‘ä»¬è®¾ç½® Filter çš„æ‰§è¡Œé¡ºåºï¼Œä¸”åœ¨ Filter ç±»ä¸Šæ·»åŠ  @Order æ³¨è§£ä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚å¦‚æœé¡¹ç›®ä¸­æœ‰å¤šä¸ªè¢« @WebFilter ä¿®é¥°çš„ Filterï¼Œé‚£ä¹ˆè¿™äº› Filter çš„æ‰§è¡Œé¡ºåºç”±å…¶ â€œç±»åçš„å­—å…¸åºâ€ å†³å®š</strong>ï¼Œä¾‹å¦‚ç±»åä¸º â€œAxxâ€ çš„ Filter çš„æ‰§è¡Œé¡ºåºè¦å…ˆäºç±»åä¸º â€œBxxâ€ çš„ Filterã€‚</p>
<blockquote>
<p>æ·»åŠ äº† @WebFilter æ³¨è§£åå°±ä¸è¦å†æ·»åŠ  @Component æ³¨è§£äº†ï¼Œå¦‚æœéƒ½æ·»åŠ ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šåˆ›å»ºä¸¤ä¸ª Filterã€‚</p>
</blockquote>
<p><strong>2. @Component æ³¨è§£</strong></p>
<p>Spring é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  @Component æ³¨è§£å°†è‡ªå®šä¹‰çš„ Bean äº¤ç»™ Spring å®¹å™¨ç®¡ç†ã€‚åŒæ ·çš„ï¼Œå¯¹äºè‡ªå®šä¹‰çš„ Filterï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ  @Component æ³¨è§£ä½¿å…¶ç”Ÿæ•ˆï¼Œè€Œä¸”è¿˜å¯ä»¥æ·»åŠ  @Order æ³¨è§£æ¥è®¾ç½®ä¸åŒ Filter çš„æ‰§è¡Œé¡ºåºã€‚</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­¤ç§é…ç½®æ–¹å¼ä¸€èˆ¬ä¸å¸¸ä½¿ç”¨ï¼Œå› ä¸ºå…¶æ— æ³•è®¾ç½® Filter çš„æ‹¦æˆªè§„åˆ™ï¼Œé»˜è®¤çš„æ‹¦æˆªè·¯å¾„ä¸º <code>/*</code>ã€‚è™½ç„¶ä¸èƒ½é…ç½®æ‹¦æˆªè§„åˆ™ï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨ doFilter æ–¹æ³•ä¸­å®šä¹‰è¯·æ±‚çš„æ”¾è¡Œè§„åˆ™ï¼Œä¾‹å¦‚å½“è¯·æ±‚çš„ URL åŒ¹é…æˆ‘ä»¬è®¾ç½®çš„è§„åˆ™æ—¶ï¼Œç›´æ¥å°†è¯¥è¯·æ±‚æ”¾è¡Œï¼Œä¹Ÿå°±æ˜¯ç«‹å³æ‰§è¡Œ <code>filterChain.doFilter(servletRequest, servletResponse);</code>ã€‚</p>
<p><strong>3. ç»§æ‰¿ OncePerRequestFilter</strong></p>
<p>OncePerRequestFilter æ˜¯ä¸€ä¸ªç”± Spring æä¾›çš„æŠ½è±¡ç±»ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç»§æ‰¿ OncePerRequestFilter çš„æ–¹å¼åˆ›å»º Filterï¼Œç„¶åé‡å†™ doFilterInternal æ–¹æ³•å®šä¹‰ Filter çš„å¤„ç†é€»è¾‘ï¼Œé‡å†™ shouldNotFilter æ–¹æ³•è®¾ç½® Filter çš„æ”¾è¡Œè§„åˆ™ã€‚å¯¹äºå¤šä¸ª Filter çš„æ‰§è¡Œé¡ºåºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ  @Order æ³¨è§£è¿›è¡Œè®¾ç½®ã€‚å½“ç„¶ï¼Œè‹¥è¦ä½¿ Filter ç”Ÿæ•ˆï¼Œè¿˜éœ€æ·»åŠ  @Component æ³¨è§£å°†å…¶æ³¨å†Œåˆ° Spring å®¹å™¨ã€‚</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CSpringFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> FilterChain filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// å¤„ç†é€»è¾‘</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">shouldNotFilter</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// æ”¾è¡Œè§„åˆ™</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å®é™…ä¸Šï¼Œæ–¹å¼ 2 å’Œæ–¹å¼ 3 æœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå› ä¸º OncePerRequestFilter åº•å±‚ä¹Ÿæ˜¯é€šè¿‡å®ç° Filter æ¥å£æ¥è¾¾åˆ°è¿‡æ»¤è¯·æ±‚/å“åº”çš„ç›®çš„ï¼Œåªä¸è¿‡ Spring åœ¨ OncePerRequestFilter ä¸­å¸®æˆ‘ä»¬å°è£…äº†è®¸å¤šåŠŸèƒ½ï¼Œå› æ­¤æ›´æ¨èé‡‡ç”¨æ­¤ç§æ–¹å¼åˆ›å»º Filterã€‚</p>
<h3 id="Filter-çš„ä¼˜å…ˆçº§"><a href="#Filter-çš„ä¼˜å…ˆçº§" class="headerlink" title="Filter çš„ä¼˜å…ˆçº§"></a>Filter çš„ä¼˜å…ˆçº§</h3><p>ä¸Šæ–‡ä¸­æåˆ°ï¼Œä½¿ç”¨é…ç½®ç±»æˆ–æ·»åŠ  @Order æ³¨è§£å¯ä»¥æ˜¾å¼çš„è®¾ç½® Filter çš„æ‰§è¡Œé¡ºåºï¼Œä¿®æ”¹ç±»åå¯ä»¥éšå¼çš„è®¾ç½® Filter çš„æ‰§è¡Œé¡ºåºã€‚å¦‚æœé¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ª Filterï¼Œä¸”è¿™äº› Filter ç”±ä¸åŒçš„æ–¹å¼åˆ›å»ºï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>èƒ½å¤Ÿç¡®å®šçš„æ˜¯ï¼ŒSpring æ ¹æ® Filter çš„ order å†³å®šå…¶ä¼˜å…ˆçº§ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡é…ç½®ç±»æˆ–è€…é€šè¿‡ @Order æ³¨è§£è®¾ç½®äº† Filter çš„ orderï¼Œé‚£ä¹ˆ <strong>order å€¼è¶Šå°çš„ Filter çš„ä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ— è®º Filter ç”±ä½•ç§æ–¹å¼åˆ›å»º</strong>ã€‚å¦‚æœå¤šä¸ª Filter çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œé‚£ä¹ˆæ‰§è¡Œé¡ºåºä¸ºï¼š</p>
<ol>
<li><p>é…ç½®ç±»ä¸­é…ç½®çš„ Filter ä¼˜å…ˆæ‰§è¡Œï¼Œå¦‚æœé…ç½®ç±»ä¸­å­˜åœ¨å¤šä¸ª Filterï¼Œé‚£ä¹ˆ Spring æŒ‰ç…§å…¶åœ¨é…ç½®ç±»ä¸­é…ç½®çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>
</li>
<li><p>@WebFilter æ³¨è§£ä¿®é¥°çš„ Filter ä¹‹åæ‰§è¡Œï¼Œå¦‚æœå­˜åœ¨å¤šä¸ª Filterï¼Œé‚£ä¹ˆ Spring æŒ‰ç…§å…¶ç±»åçš„å­—å…¸åºä¾æ¬¡æ‰§è¡Œã€‚</p>
</li>
<li><p>@Component æ³¨è§£ä¿®é¥°çš„ Filter æœ€åæ‰§è¡Œï¼Œå¦‚æœå­˜åœ¨å¤šä¸ª Filterï¼Œé‚£ä¹ˆ Spring æŒ‰ç…§å…¶ç±»åçš„å­—å…¸åºä¾æ¬¡æ‰§è¡Œã€‚</p>
</li>
</ol>
<p>æ³¨æ„ï¼Œä»¥ä¸Šä¼˜å…ˆçº§é¡ºåºä»…é€‚ç”¨äº order ç›¸åŒçš„ç‰¹æ®Šæƒ…å†µã€‚å¦‚æœæˆ‘ä»¬ä¸é…ç½® Filter çš„ orderï¼Œé‚£ä¹ˆ Spring é»˜è®¤å°†å…¶ order è®¾ç½®ä¸º <code>LOWEST_PRECEDENCE = Integer.MAX_VALUE</code>ï¼Œä¹Ÿå°±æ˜¯æœ€ä½ä¼˜å…ˆçº§ã€‚ç”±äºè¢« @WebFilter æ³¨è§£ä¿®é¥°çš„ Filter æ— æ³•æ˜¾å¼é…ç½®ä¼˜å…ˆçº§ï¼Œå› æ­¤å…¶ order ä¸º Integer.MAX_VALUEã€‚æœ¬æ–‡æ‰€è¯´çš„ Filter çš„ä¼˜å…ˆçº§æŒ‡çš„æ˜¯ Filter å¯¹è¯·æ±‚åšé¢„å¤„ç†çš„ä¼˜å…ˆçº§ï¼Œå¯¹å“åº”åšåå¤„ç†çš„ä¼˜å…ˆçº§ä¸ä¹‹ç›¸åã€‚</p>
<blockquote>
<p>ä»¥ä¸Šç»“è®ºç”±ç¬”è€…ç»è¿‡æµ‹è¯•ä»¥åŠé˜…è¯»æºç å¾—å‡ºï¼Œå¦‚æœ‰ç†è§£é”™è¯¯ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ ğŸ˜ã€‚å…³äºæºç éƒ¨åˆ†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ ServletContextInitializerBeans ç±»å’Œ AnnotationAwareOrderComparator ç±»çš„æºç ï¼Œç¬”è€…åœ¨è¿™é‡Œå°±ä¸å…·ä½“åˆ†æäº† ğŸ˜ˆã€‚</p>
</blockquote>
<!-- è¿™äº› Filter çš„åˆå§‹åŒ–é¡ºåºç”± filterNameï¼ˆé»˜è®¤ä¸ºç±»åçš„é¦–å­—æ¯å°å†™ï¼‰çš„ hash å€¼å†³å®š -->

<h3 id="Filter-çš„åº”ç”¨åœºæ™¯"><a href="#Filter-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="Filter çš„åº”ç”¨åœºæ™¯"></a>Filter çš„åº”ç”¨åœºæ™¯</h3><p>Filter çš„å¸¸è§åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>è§£å†³è·¨åŸŸè®¿é—®ï¼šå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®å¾€å¾€å­˜åœ¨è·¨åŸŸè®¿é—®çš„é—®é¢˜ï¼ŒFilter å…è®¸æˆ‘ä»¬åœ¨ response çš„ Header ä¸­è®¾ç½® â€œAccess-Control-Allow-Originâ€ã€â€Access-Control-Allow-Methodsâ€ ç­‰å¤´åŸŸï¼Œä»¥æ­¤è§£å†³è·¨åŸŸå¤±è´¥é—®é¢˜ã€‚</p>
</li>
<li><p>è®¾ç½®å­—ç¬¦ç¼–ç ï¼šå­—ç¬¦ç¼–ç  Filter å¯ä»¥åœ¨ request æäº¤åˆ° Servlet ä¹‹å‰æˆ–è€…åœ¨ response è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹å‰ä¸ºè¯·æ±‚/å“åº”è®¾ç½®ç‰¹å®šçš„ç¼–ç æ ¼å¼ï¼Œä»¥è§£å†³è¯·æ±‚/å“åº”å†…å®¹ä¹±ç çš„é—®é¢˜ã€‚</p>
</li>
<li><p>è®°å½•æ—¥å¿—ï¼šæ—¥å¿—è®°å½• Filter å¯ä»¥åœ¨æ‹¦æˆªåˆ°è¯·æ±‚åï¼Œè®°å½•è¯·æ±‚çš„ IPã€è®¿é—®çš„ URLï¼Œæ‹¦æˆªåˆ°å“åº”åè®°å½•è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚å½“ä¸éœ€è¦è®°å½•æ—¥å¿—æ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°† Filter çš„é…ç½®æ³¨é‡Šæ‰ã€‚</p>
</li>
<li><p>æ ¡éªŒæƒé™ï¼šWeb æœåŠ¡ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚æ—¶ä¼šæºå¸¦ cookie æˆ–è€… token è¿›è¡Œèº«ä»½è®¤è¯ï¼Œæƒé™æ ¡éªŒ Filter å¯ä»¥åœ¨ request æäº¤åˆ° Servlet ä¹‹å‰å¯¹ cookie æˆ– token è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœç”¨æˆ·æœªç™»å½•æˆ–è€…æƒé™ä¸å¤Ÿï¼Œé‚£ä¹ˆ Filter å¯ä»¥å¯¹è¯·æ±‚åšé‡å®šå‘æˆ–è¿”å›é”™è¯¯ä¿¡æ¯ã€‚</p>
</li>
<li><p>æ›¿æ¢å†…å®¹ï¼šå†…å®¹æ›¿æ¢ Filter å¯ä»¥å¯¹ç½‘ç«™çš„å†…å®¹è¿›è¡Œæ§åˆ¶ï¼Œé˜²æ­¢è¾“å…¥/è¾“å‡ºéæ³•å†…å®¹å’Œæ•æ„Ÿä¿¡æ¯ã€‚ä¾‹å¦‚åœ¨è¯·æ±‚åˆ°è¾¾ Servlet ä¹‹å‰å¯¹è¯·æ±‚çš„å†…å®¹è¿›è¡Œè½¬ä¹‰ï¼Œé˜²æ­¢ XSS æ”»å‡»ï¼›åœ¨ Servlet å°†å†…å®¹è¾“å‡ºåˆ° response æ—¶ï¼Œä½¿ç”¨ response å°†å†…å®¹ç¼“å­˜èµ·æ¥ï¼Œç„¶ååœ¨ Filter ä¸­è¿›è¡Œæ›¿æ¢ï¼Œæœ€åå†è¾“å‡ºåˆ°å®¢æˆ·æµè§ˆå™¨ï¼ˆç”±äºé»˜è®¤çš„ response å¹¶ä¸èƒ½ä¸¥æ ¼çš„ç¼“å­˜è¾“å‡ºå†…å®¹ï¼Œå› æ­¤éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªå…·å¤‡ç¼“å­˜åŠŸèƒ½çš„ responseï¼‰ã€‚</p>
</li>
</ul>
<blockquote>
<p>Filter åº”ç”¨åœºæ™¯çš„ç›¸å…³å†…å®¹å‚è€ƒè‡ªã€ŠJava Web æ•´åˆå¼€å‘ä¹‹ç‹è€…å½’æ¥ã€‹ï¼Œå¥½ä¸­äºŒçš„ä¹¦å ğŸ¤£ï¼Œå…³äºè‡ªå®šä¹‰å…·å¤‡ç¼“å­˜åŠŸèƒ½çš„ response å¯å‚è€ƒè¯¥ä¹¦çš„ P175ã€‚</p>
</blockquote>
<h3 id="Filter-çš„å®ç°åŸç†"><a href="#Filter-çš„å®ç°åŸç†" class="headerlink" title="Filter çš„å®ç°åŸç†"></a>Filter çš„å®ç°åŸç†</h3><p>äº†è§£äº† Filter çš„ä½¿ç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ Filter çš„å®ç°åŸç†ã€‚ä¸Šæ–‡ä¸­æåˆ°ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šåœ¨è¿‡æ»¤é“¾ä¸Šä¾æ¬¡ä¼ é€’ï¼Œé“¾ä¸Šçš„æ¯ä¸ª Filter éƒ½ä¼šè°ƒç”¨ doFilter æ–¹æ³•å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚è¿™ä¸ªè¿‡ç¨‹èƒ½å¤Ÿæœ‰æ¡ä¸ç´Šçš„è¿›è¡Œï¼Œåº•å±‚ä¾é çš„æ˜¯å‡½æ•°çš„å›è°ƒæœºåˆ¶ã€‚</p>
<p><strong>1. å›è°ƒå‡½æ•°</strong></p>
<p>åœ¨ä»‹ç» Filter çš„å›è°ƒæœºåˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å›è°ƒå‡½æ•°çš„æ¦‚å¿µã€‚å¦‚æœå°†å‡½æ•°ï¼ˆC++ ä¸­çš„å‡½æ•°æŒ‡é’ˆï¼ŒJava ä¸­çš„åŒ¿åå‡½æ•°ã€æ–¹æ³•å¼•ç”¨ç­‰ï¼‰ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸»æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ç§°ä¸ºå›è°ƒå‡½æ•°ï¼Œä¸»æ–¹æ³•ä¼šåœ¨æŸä¸€æ—¶åˆ»è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</p>
<blockquote>
<p>ä¸ºäº†ä¾¿äºåŒºåˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨ â€œä¸»æ–¹æ³•â€ å’Œ â€œå‡½æ•°â€ æ¥åˆ†è¾¨ä¸»å‡½æ•°å’Œå›è°ƒå‡½æ•°ã€‚</p>
</blockquote>
<p>ä½¿ç”¨å›è°ƒå‡½æ•°çš„å¥½å¤„æ˜¯èƒ½å¤Ÿå®ç°å‡½æ•°é€»è¾‘çš„è§£è€¦ï¼Œä¸»æ–¹æ³•å†…å¯ä»¥å®šä¹‰é€šç”¨çš„å¤„ç†é€»è¾‘ï¼Œéƒ¨åˆ†ç‰¹å®šçš„æ“ä½œåˆ™äº¤ç»™å›è°ƒå‡½æ•°æ¥å®Œæˆã€‚ä¾‹å¦‚ Java ä¸­ Arrays ç±»çš„ <code>sort(T[] a, Comparator&lt;? super T&gt; c)</code> æ–¹æ³•å…è®¸æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ¯”è¾ƒå™¨æ¥è‡ªå®šä¹‰æ’åºè§„åˆ™ï¼Œè¿™ä¸ªæ¯”è¾ƒå™¨çš„ compare æ–¹æ³•å°±å±äºå›è°ƒå‡½æ•°ï¼Œsort æ–¹æ³•ä¼šåœ¨æ’åºæ—¶è°ƒç”¨ compare æ–¹æ³•ã€‚</p>
<p><strong>2. Filter çš„å›è°ƒæœºåˆ¶</strong></p>
<p>æ¥ä¸‹æ¥ä»‹ç» Filter çš„å›è°ƒæœºåˆ¶ï¼Œä¸Šæ–‡ä¸­æåˆ°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ xxFilter ç±»éœ€è¦å®ç° Filter æ¥å£ï¼Œä¸”éœ€è¦é‡å†™ doFilter æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span>ServletRequest servletRequest<span class="token punctuation">,</span> ServletResponse servletResponse<span class="token punctuation">,</span> FilterChain filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ...</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Filter æ¥å£çš„ doFilter æ–¹æ³•æ¥æ”¶ä¸€ä¸ª FilterChain ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ª FilterChain å¯¹è±¡å¯è®¤ä¸ºæ˜¯ä¼ é€’ç»™ doFilter æ–¹æ³•çš„å›è°ƒå‡½æ•°ï¼Œä¸¥æ ¼æ¥è¯´åº”è¯¥æ˜¯è¿™ä¸ª FilterChain å¯¹è±¡çš„ doFilter æ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œæåˆ°äº†ä¸¤ä¸ª doFilter æ–¹æ³•ã€‚Filter æ¥å£çš„ doFilter æ–¹æ³•åœ¨æ‰§è¡Œç»“æŸæˆ–æ‰§è¡Œå®ŒæŸäº›æ­¥éª¤åä¼šè°ƒç”¨ FilterChain å¯¹è±¡çš„ doFilter æ–¹æ³•ï¼Œå³è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</p>
<p>FilterChain å¯¹è±¡çš„å®é™…ç±»å‹ä¸º ApplicationFilterChainï¼Œå…¶ doFilter() æ–¹æ³•çš„å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼ˆçœç•¥éƒ¨åˆ†ä»£ç ï¼‰ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationFilterChain</span> <span class="token keyword">implements</span> <span class="token class-name">FilterChain</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span>ServletRequest request<span class="token punctuation">,</span> ServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ...</span>
        <span class="token function">internalDoFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">internalDoFilter</span><span class="token punctuation">(</span>ServletRequest request<span class="token punctuation">,</span> ServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// è·å–ç¬¬ pos ä¸ª filter, å³ xxFilter  </span>
            ApplicationFilterConfig filterConfig <span class="token operator">=</span> filters<span class="token punctuation">[</span>pos<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       
            Filter filter <span class="token operator">=</span> filterConfig<span class="token punctuation">.</span><span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// ...</span>
            <span class="token comment" spellcheck="true">// è°ƒç”¨ xxFilter çš„ doFilter æ–¹æ³•</span>
            filter<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯è§ï¼ŒApplicationFilterChain çš„ doFilter æ–¹æ³•é¦–å…ˆæ ¹æ®ç´¢å¼•æŸ¥è¯¢åˆ°æˆ‘ä»¬å®šä¹‰çš„ xxFilterï¼Œç„¶åè°ƒç”¨ xxFilter çš„ doFilter æ–¹æ³•ï¼Œåœ¨è°ƒç”¨æ—¶ï¼ŒApplicationFilterChain ä¼šå°†è‡ªå·±ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ã€‚xxFilter çš„ doFilter æ–¹æ³•æ‰§è¡Œå®ŒæŸäº›æ­¥éª¤åï¼Œä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå³ ApplicationFilterChain çš„ doFilter æ–¹æ³•ï¼Œè¿™æ · ApplicationFilterChain å°±å¯ä»¥è·å–åˆ°ä¸‹ä¸€ä¸ª xxFilterï¼Œå¹¶è°ƒç”¨ä¸‹ä¸€ä¸ª xxFilter çš„ doFilter æ–¹æ³•ï¼Œå¦‚æ­¤å¾ªç¯ä¸‹å»ï¼Œç›´åˆ°æ‰€æœ‰çš„ xxFilter å…¨éƒ¨è¢«è°ƒç”¨ã€‚æ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6.jpg" alt></p>
<blockquote>
<p>xxFilter æ‰§è¡Œå›è°ƒå‡½æ•°çš„è¿‡ç¨‹å°±åƒæ˜¯ç»™äº† ApplicationFilterChain ä¸€ä¸ªé€šçŸ¥ï¼Œå³é€šçŸ¥ ApplicationFilterChain å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ª xxFilter çš„å¤„ç†é€»è¾‘äº†ã€‚</p>
</blockquote>
<p>ç»¼ä¸Šï¼Œå¦‚æœæˆ‘ä»¬åœ¨é‡å†™è‡ªå®šä¹‰ Filter çš„ doFilter æ–¹æ³•æ—¶æ²¡æœ‰æ·»åŠ  <code>filterChain.doFilter(servletRequest, servletResponse);</code>ï¼Œé‚£ä¹ˆè¯¥ Filter ä¹‹åçš„å…¶å®ƒ Filter å’Œ Servlet å°±ä¸ä¼šè¢«è°ƒç”¨ã€‚</p>
<h2 id="æ‹¦æˆªå™¨-Interceptor"><a href="#æ‹¦æˆªå™¨-Interceptor" class="headerlink" title="æ‹¦æˆªå™¨ Interceptor"></a>æ‹¦æˆªå™¨ Interceptor</h2><h3 id="Interceptor-åŸºæœ¬ä»‹ç»"><a href="#Interceptor-åŸºæœ¬ä»‹ç»" class="headerlink" title="Interceptor åŸºæœ¬ä»‹ç»"></a>Interceptor åŸºæœ¬ä»‹ç»</h3><blockquote>
<p>æœ¬æ–‡æ‰€è¯´çš„æ‹¦æˆªå™¨æŒ‡çš„æ˜¯ Spring MVC ä¸­çš„æ‹¦æˆªå™¨ã€‚</p>
</blockquote>
<p>æ‹¦æˆªå™¨ Interceptor æ˜¯ Spring MVC ä¸­çš„é«˜çº§ç»„ä»¶ä¹‹ä¸€ï¼Œå…¶ä½œç”¨æ˜¯æ‹¦æˆªç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚å¤„ç†å‰ååšä¸€äº›è‡ªå®šä¹‰çš„å¤„ç†ï¼Œå¦‚æ ¡éªŒæƒé™ã€è®°å½•æ—¥å¿—ç­‰ã€‚è¿™ä¸€ç‚¹å’Œ Filter éå¸¸ç›¸ä¼¼ï¼Œä½†ä¸åŒçš„æ˜¯ï¼ŒFilter åœ¨è¯·æ±‚åˆ°è¾¾ Servlet ä¹‹å‰å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œè€Œ Interceptor åˆ™æ˜¯åœ¨è¯·æ±‚åˆ°è¾¾ Controller ä¹‹å‰å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå“åº”ä¹ŸåŒç†ã€‚</p>
<p>ä¸ Filter ä¸€æ ·ï¼ŒInterceptor ä¹Ÿå…·å¤‡é“¾å¼ç»“æ„ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¯ä»¥é…ç½®å¤šä¸ª Interceptorï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæ¯ä¸ª Interceptor æ ¹æ®å…¶å£°æ˜çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>
<h3 id="åˆ›å»º-Interceptor"><a href="#åˆ›å»º-Interceptor" class="headerlink" title="åˆ›å»º Interceptor"></a>åˆ›å»º Interceptor</h3><p>åˆ›å»º Interceptor éœ€è¦å®ç° org.springframework.web.servlet.HandlerInterceptor æ¥å£ï¼ŒHandlerInterceptor æ¥å£ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><p>preHandleï¼šåœ¨ Controller æ–¹æ³•æ‰§è¡Œå‰è¢«è°ƒç”¨ï¼Œå¯ä»¥å¯¹è¯·æ±‚åšé¢„å¤„ç†ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª boolean å˜é‡ï¼Œåªæœ‰å½“è¿”å›å€¼ä¸º true æ—¶ï¼Œç¨‹åºæ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p>
</li>
<li><p>postHandleï¼šåœ¨ Controller æ–¹æ³•æ‰§è¡Œç»“æŸï¼ŒDispatcherServlet è¿›è¡Œè§†å›¾æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼Œè¯¥æ–¹æ³•å†…å¯ä»¥æ“ä½œ Controller å¤„ç†åçš„ ModelAndView å¯¹è±¡ã€‚</p>
</li>
<li><p>afterCompletionï¼šåœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæˆï¼ˆåŒ…æ‹¬è§†å›¾æ¸²æŸ“ï¼‰åè¢«è°ƒç”¨ï¼Œé€šå¸¸ç”¨æ¥æ¸…ç†èµ„æºã€‚</p>
</li>
</ul>
<p>æ³¨æ„ï¼ŒpostHandle æ–¹æ³•å’Œ afterCompletion æ–¹æ³•æ‰§è¡Œçš„å‰ææ¡ä»¶æ˜¯ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º trueã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Interceptorï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> Object handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Interceptor æ‹¦æˆªåˆ°äº†è¯·æ±‚: "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> Object handler<span class="token punctuation">,</span> ModelAndView modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Interceptor æ“ä½œ modelAndView..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> Object handler<span class="token punctuation">,</span> Exception ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Interceptor æ¸…ç†èµ„æº..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é…ç½®-Interceptor"><a href="#é…ç½®-Interceptor" class="headerlink" title="é…ç½® Interceptor"></a>é…ç½® Interceptor</h3><p>Interceptor éœ€è¦æ³¨å†Œåˆ° Spring å®¹å™¨æ‰èƒ½å¤Ÿç”Ÿæ•ˆï¼Œæ³¨å†Œçš„æ–¹æ³•æ˜¯åœ¨é…ç½®ç±»ä¸­å®ç° WebMvcConfigurer æ¥å£ï¼Œå¹¶é‡å†™ addInterceptors æ–¹æ³•:</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestInterceptorConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> TestInterceptor testInterceptor<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span>InterceptorRegistry registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>testInterceptor<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**/*.css"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.js"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.png"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.jpg"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.jpeg"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒaddInterceptor æ–¹æ³•ç”¨äºæ³¨å†Œ Interceptorï¼›addPathPatterns æ–¹æ³•ç”¨äºè®¾ç½®æ‹¦æˆªè§„åˆ™ï¼›excludePathPatterns æ–¹æ³•ç”¨äºè®¾ç½®æ”¾è¡Œè§„åˆ™ï¼Œorder æ–¹æ³•ç”¨äºè®¾ç½® Interceptor çš„ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p>
<h3 id="æµ‹è¯•-Interceptor"><a href="#æµ‹è¯•-Interceptor" class="headerlink" title="æµ‹è¯• Interceptor"></a>æµ‹è¯• Interceptor</h3><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡ï¼Œæ¥æµ‹è¯• Interceptor æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/hello"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨å¤„ç†è¯·æ±‚..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯·æ±‚å¤„ç†å®Œæˆ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"I'm fine, thank you."</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯åŠ¨é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>localhost:8080/hello</code>ï¼Œè¯·æ±‚å¤„ç†å®Œæˆåï¼Œæ§åˆ¶å°æ‰“å°äº†å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/TestInterceptor.jpg" alt></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒInterceptor æˆåŠŸæ‹¦æˆªåˆ°äº†è®¿é—® Controller çš„ <code>/hello</code> è¯·æ±‚å’Œè®¿é—®é™æ€èµ„æºçš„ <code>/favicon.ico</code> è¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚å¤„ç†å‰åæ‰§è¡Œäº†ç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚</p>
<p>å½“éœ€è¦è®¾ç½®å¤šä¸ª Interceptor æ—¶ï¼Œå¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸­æ·»åŠ  Interceptor çš„é…ç½®è§„åˆ™ï¼Œä¾‹å¦‚å¢åŠ  TestInterceptor2ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestInterceptorConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> TestInterceptor testInterceptor<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> TestInterceptor2 testInterceptor2<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span>InterceptorRegistry registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>testInterceptor<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**/*.css"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.js"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.png"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.jpg"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.jpeg"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>testInterceptor2<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**/*.css"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.js"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.png"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.jpg"</span><span class="token punctuation">,</span> <span class="token string">"/**/*.jpeg"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Interceptor çš„æ‰§è¡Œé¡ºåºç”±å…¶é…ç½®çš„ order å†³å®šï¼Œorder è¶Šå°è¶Šå…ˆæ‰§è¡Œï¼Œæ³¨æ„è¿™é‡ŒæŒ‡çš„æ˜¯ preHandle æ–¹æ³•çš„æ‰§è¡Œé¡ºåºï¼ŒpostHandle å’Œ afterCompletion çš„æ‰§è¡Œé¡ºåºä¸ preHandle ç›¸å</strong>ï¼Œä¾‹å¦‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ‰§è¡Œé¡ºåºä¸ºï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/%E5%A4%9A%E4%B8%AAInterceptor.jpg" alt></p>
<p>å¦‚æœæˆ‘ä»¬ä¸é…ç½® orderï¼Œé‚£ä¹ˆ Spring é»˜è®¤å°† order è®¾ç½®ä¸º 0ï¼ˆå¯ä»¥æŸ¥çœ‹ InterceptorRegistration ç±»çš„æºç ï¼‰ã€‚<strong>å¦‚æœä¸åŒçš„ Interceptor å…·æœ‰ç›¸åŒçš„ orderï¼Œé‚£ä¹ˆå…¶æ‰§è¡Œé¡ºåºä¸ºé…ç½®ç±»ä¸­çš„æ³¨å†Œé¡ºåº</strong>ã€‚</p>
<h3 id="Interceptor-çš„åº”ç”¨åœºæ™¯"><a href="#Interceptor-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="Interceptor çš„åº”ç”¨åœºæ™¯"></a>Interceptor çš„åº”ç”¨åœºæ™¯</h3><p>Interceptor çš„åº”ç”¨åœºå¯ä»¥å‚è€ƒä¸Šæ–‡ä¸­ä»‹ç»çš„ Filter çš„åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥è¯´ Filter èƒ½åšåˆ°çš„äº‹ Interceptor éƒ½èƒ½åšã€‚ç”±äº Filter åœ¨ Servlet å‰åèµ·ä½œç”¨ï¼Œè€Œ Interceptor å¯ä»¥åœ¨ Controller æ–¹æ³•å‰åèµ·ä½œç”¨ï¼Œä¾‹å¦‚æ“ä½œ Controller å¤„ç†åçš„ ModelAndViewï¼Œå› æ­¤ Interceptor æ›´åŠ çµæ´»ï¼Œåœ¨ Spring é¡¹ç›®ä¸­ï¼Œå¦‚æœèƒ½ä½¿ç”¨ Interceptor çš„è¯å°½é‡ä½¿ç”¨ Interceptorã€‚</p>
<h3 id="Interceptor-çš„å®ç°åŸç†"><a href="#Interceptor-çš„å®ç°åŸç†" class="headerlink" title="Interceptor çš„å®ç°åŸç†"></a>Interceptor çš„å®ç°åŸç†</h3><p>äº†è§£äº† Interceptor çš„ä½¿ç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿæ¥åˆ†æä¸€ä¸‹ Interceptor çš„å®ç°åŸç†ã€‚Interceptor çš„è°ƒç”¨å‘ç”Ÿåœ¨ DispatcherServlet çš„ doDispatch æ–¹æ³•ä¸­ï¼ŒDispatcherServlet æ˜¯ Spring MVC ä¸­è¯·æ±‚çš„ç»Ÿä¸€å…¥å£ï¼Œå½“å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒDispatcherServlet ä¼šè°ƒç”¨ doDispatch æ–¹æ³•å¤„ç†å½“å‰è¯·æ±‚ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doDispatch</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// çœç•¥éƒ¨åˆ†ä»£ç </span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        ModelAndView mv <span class="token operator">=</span> null<span class="token punctuation">;</span>
        Exception dispatchException <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            processedRequest <span class="token operator">=</span> <span class="token function">checkMultipart</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            multipartRequestParsed <span class="token operator">=</span> <span class="token punctuation">(</span>processedRequest <span class="token operator">!=</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// æ ¹æ®è¯·æ±‚æŸ¥æ‰¾å¤„ç†é“¾ HandlerExecutionChain</span>
            mappedHandler <span class="token operator">=</span> <span class="token function">getHandler</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">noHandlerFound</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// è·å–é€‚é…å™¨ HandlerAdapter, HandlerAdapter ç”¨äºå¤„ç†è¯·æ±‚</span>
            HandlerAdapter ha <span class="token operator">=</span> <span class="token function">getHandlerAdapter</span><span class="token punctuation">(</span>mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// çœç•¥éƒ¨åˆ†ä»£ç </span>

            <span class="token comment" spellcheck="true">// ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„ preHandle æ–¹æ³•</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mappedHandler<span class="token punctuation">.</span><span class="token function">applyPreHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// æ‰§è¡Œ Controller æ–¹æ³•, è¿”å› ModelAndView</span>
            mv <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncManager<span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token function">applyDefaultViewName</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„ postHandle æ–¹æ³•, é¡ºåºå’Œ preHandle æ–¹æ³•ç›¸å</span>
            mappedHandler<span class="token punctuation">.</span><span class="token function">applyPostHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dispatchException <span class="token operator">=</span> ex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dispatchException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">"Handler dispatch failed"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// è¿›è¡Œè§†å›¾æ¸²æŸ“, ç»“æŸåæ‰§è¡Œæ‹¦æˆªå™¨çš„ afterCompletion æ–¹æ³•</span>
        <span class="token function">processDispatchResult</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span> mv<span class="token punctuation">,</span> dispatchException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// å¦‚æœå‘ç”Ÿå¼‚å¸¸, é‚£ä¹ˆæ‰§è¡Œæ‹¦æˆªå™¨çš„ afterCompletion æ–¹æ³•å¹¶æŠ›å‡ºå¼‚å¸¸</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">"Handler processing failed"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li><p>é¦–å…ˆè·å–å½“å‰è¯·æ±‚å¯¹åº”çš„å¤„ç†é“¾ HandlerExecutionChainï¼Œ<strong>HandlerExecutionChain ä¸­åŒ…å«äº†å½“å‰è¯·æ±‚åŒ¹é…çš„ Interceptor åˆ—è¡¨</strong>ã€‚</p>
</li>
<li><p>ç„¶åæ ¹æ® HandlerExecutionChain è·å–é€‚é…å™¨ HandlerAdapterï¼ŒHandlerAdapter ç”¨äºå¤„ç†å½“å‰è¯·æ±‚ã€‚</p>
</li>
<li><p>ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰ Interceptor çš„ preHandle æ–¹æ³•ï¼Œå¦‚æœæŸä¸ª preHandle æ–¹æ³•è¿”å› falseï¼Œé‚£ä¹ˆç¨‹åºå°†ä¸å†å‘ä¸‹æ‰§è¡Œã€‚</p>
</li>
<li><p>è°ƒç”¨ HandlerAdapter å¤„ç†è¯·æ±‚ï¼Œè¿”å› ModelAndViewã€‚</p>
</li>
<li><p>è¯·æ±‚å¤„ç†å®Œæˆåï¼Œä¾æ¬¡æ‰§è¡Œæ‰€æœ‰ Interceptor çš„ postHandle æ–¹æ³•ï¼Œæ‰§è¡Œçš„é¡ºåºä¸ preHandle æ–¹æ³•ç›¸åã€‚</p>
</li>
<li><p>è¿›è¡Œè§†å›¾æ¸²æŸ“ï¼Œæ¸²æŸ“ç»“æŸåæ‰§è¡Œæ‰€æœ‰ Interceptor çš„ afterCompletion æ–¹æ³•ï¼Œæ‰§è¡Œé¡ºåºä¸ postHandle æ–¹æ³•ç›¸åŒã€‚</p>
</li>
<li><p>å¦‚æœä»¥ä¸Šæ“ä½œå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆæ‰§è¡Œæ‰€æœ‰ Interceptor çš„ afterCompletion æ–¹æ³•å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
</li>
</ol>
<blockquote>
<p>ç”±ä¸Šè¿°è¿‡ç¨‹æˆ‘ä»¬å¾—çŸ¥ï¼Œå¦‚æœ Controller æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆ postHandle æ–¹æ³•å°†ä¸ä¼šæ‰§è¡Œï¼ŒafterCompletion æ–¹æ³•åˆ™ä¸€å®šæ‰§è¡Œã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹åˆ†æä¸€ä¸‹ getHandler æ–¹æ³•ï¼ˆDispatcherServlet ç±»ä¸­å®šä¹‰çš„ï¼‰èƒŒåçš„é€»è¾‘ï¼Œçœ‹çœ‹ Interceptor æ˜¯å¦‚ä½•åŠ è½½åˆ°ï¼ˆæˆ–è€…è¯´æ˜¯å°è£…åˆ°ï¼‰HandlerExecutionChain ä¸­çš„ã€‚getHandler æ–¹æ³•é¦–å…ˆéå†æ‰€æœ‰çš„ HandlerMappingï¼Œç„¶åæ‰¾åˆ°åŒ¹é…å½“å‰è¯·æ±‚çš„ HandlerMappingï¼Œå¹¶è°ƒç”¨è¯¥ HandlerMapping çš„ getHandler æ–¹æ³•è·å– HandlerExecutionChainï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/handlerMapping%E8%8E%B7%E5%8F%96handler.png" alt></p>
<p>æ­¤å¤„çš„ â€œåŒ¹é…å½“å‰è¯·æ±‚çš„ HandlerMappingâ€ æŒ‡çš„æ˜¯ RequestMappingHandlerMappingï¼Œå…¶åœ¨ WebMvcConfigurationSupport ç±»ä¸­å®Œæˆåˆå§‹åŒ–ï¼Œä¸”åˆå§‹åŒ–æ—¶ä¼šåŠ è½½ Interceptorï¼ŒåŠ è½½çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/RequestMappingHandlerMapping%E5%8A%A0%E8%BD%BD%E6%8B%A6%E6%88%AA%E5%99%A8.png" alt></p>
<ol>
<li><p>RequestMappingHandlerMapping åœ¨åŠ è½½ Interceptor ä¹‹å‰éœ€è¦å…ˆè°ƒç”¨ getInterceptors æ–¹æ³•è·å– Interceptorã€‚</p>
</li>
<li><p>getInterceptors æ–¹æ³•éœ€è¦è°ƒç”¨ addInterceptors æ–¹æ³•å°† Interceptor å°è£…åˆ° registryï¼ˆInterceptorRegistry å¯¹è±¡ï¼‰ä¸­ã€‚</p>
</li>
<li><p>addInterceptors æ–¹æ³•æ²¿è°ƒç”¨é“¾å‘ä¸‹å¯è¿½è¸ªåˆ° WebMvcConfigurerComposite ç±»çš„ addInterceptors æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæ‰§è¡Œæˆ‘ä»¬åœ¨é…ç½®ç±»ä¸­é‡å†™çš„ addInterceptors æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„æ‰€æœ‰ Interceptor éƒ½ä¼šåŠ è½½åˆ° registry ä¸­ã€‚</p>
</li>
<li><p>å›åˆ° getInterceptors æ–¹æ³•ï¼Œæ‰§è¡Œ <code>registry.getInterceptors();</code> å°±å¯ä»¥ä» registry ä¸­è·å–åˆ° Interceptor äº†ã€‚</p>
</li>
</ol>
<p>ä»¥ä¸Šæ˜¯ RequestMappingHandlerMapping åŠ è½½ Interceptor çš„è¿‡ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­åˆ†æ RequestMappingHandlerMapping çš„ getHandler æ–¹æ³•ï¼Œäº†è§£ Interceptor æ˜¯å¦‚ä½•ä» RequestMappingHandlerMapping åŠ è½½åˆ° HandlerExecutionChain ä¸­çš„ï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/%E6%8B%A6%E6%88%AA%E5%99%A8%E5%8A%A0%E8%BD%BD%E5%88%B0HandlerExecutionChain.png" alt></p>
<ol>
<li><p>RequestMappingHandlerMapping çš„ getHandler æ–¹æ³•åœ¨å…¶çˆ¶ç±» AbstractHandlerMapping ä¸­å®šä¹‰ï¼ŒgetHandler æ–¹æ³•ä¼šè°ƒç”¨ getHandlerExecutionChain æ–¹æ³•è·å– HandlerExecutionChainã€‚</p>
</li>
<li><p>getHandlerExecutionChain æ–¹æ³•ä¸­æœ‰ä¸€æ®µä»£ç çš„å¤„ç†é€»è¾‘æ˜¯éå†å½“å‰ HandlerMappingï¼ˆRequestMappingHandlerMappingï¼‰åŠ è½½çš„ Interceptorï¼Œå¦‚æœæŸä¸ª Interceptor ä¸å½“å‰è¯·æ±‚åŒ¹é…ï¼Œé‚£ä¹ˆå°†å…¶æ·»åŠ åˆ° HandlerExecutionChainã€‚MappedInterceptor æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ Interceptor çš„ç±»å‹ï¼Œregistry åœ¨åŠ è½½ Interceptor æ—¶ä¼šå°†å…¶å°è£…ä¸º MappedInterceptor å¯¹è±¡ã€‚</p>
</li>
</ol>
<p>HandlerExecutionChain åŠ è½½åˆ° Interceptor åï¼Œå°±å¯ä»¥è°ƒç”¨ preHandle ç­‰æ–¹æ³•å¯¹è¯·æ±‚/å“åº”è¿›è¡Œå¤„ç†ã€‚</p>
<blockquote>
<p>ä¹‹æ‰€ä»¥èŠ±è´¹è¾ƒå¤šçš„ç¯‡å¹…åˆ†æ Interceptor çš„å®ç°åŸç†ï¼Œæ˜¯å› ä¸ºè®¸å¤šæ–‡ç« éƒ½æœ‰è®²åˆ° Interceptor æ˜¯åŸºäº Java çš„åå°„æœºåˆ¶ï¼ˆåŠ¨æ€ä»£ç†ï¼‰æ¥å®ç°çš„ï¼Œç¬”è€…ä¹‹å‰åœ¨ä»‹ç» Interceptor æ—¶ä¹Ÿæ˜¯è¿™æ ·å†™çš„ ğŸ˜‚ï¼Œçœ‹äº†æºç åæ‰çŸ¥é“è¿™ç§è¯´æ³•æ˜¯ä¸æ­£ç¡®çš„ï¼Œæ„Ÿè°¢æ˜é‡‘ä¸Šçš„å°ä¼™ä¼´æŒ‡å‡ºæˆ‘æ–‡ç« çš„é”™è¯¯ä¹‹å¤„ ğŸ‘ã€‚</p>
</blockquote>
<h2 id="Filter-å’Œ-Interceptor-çš„åŒºåˆ«"><a href="#Filter-å’Œ-Interceptor-çš„åŒºåˆ«" class="headerlink" title="Filter å’Œ Interceptor çš„åŒºåˆ«"></a>Filter å’Œ Interceptor çš„åŒºåˆ«</h2><p><strong>1. è§„èŒƒä¸åŒ</strong></p>
<p>Filter åœ¨ Servlet è§„èŒƒä¸­å®šä¹‰ï¼Œä¾èµ–äº Servlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰ï¼›Interceptor ç”± Spring å®šä¹‰ï¼Œä¾èµ–äº Spring å®¹å™¨ï¼ˆIoC å®¹å™¨ï¼‰ã€‚</p>
<p><strong>2. é€‚ç”¨èŒƒå›´ä¸åŒ</strong></p>
<p>Filter ä»…å¯ç”¨äº Web ç¨‹åºï¼Œå› ä¸ºå…¶ä¾èµ–äº Servlet å®¹å™¨ï¼›Interceptor ä¸ä»…å¯ä»¥ç”¨äº Web ç¨‹åºï¼Œè¿˜å¯ä»¥ç”¨äº Applicationã€Swing ç­‰ç¨‹åºã€‚ </p>
<p><strong>3. è§¦å‘æ—¶æœºä¸åŒ</strong></p>
<p>Filter åœ¨è¯·æ±‚è¿›å…¥ Servlet å®¹å™¨ï¼Œä¸”åˆ°è¾¾ Servlet ä¹‹å‰å¯¹è¯·æ±‚åšé¢„å¤„ç†ï¼›åœ¨ Servlet å¤„ç†å®Œè¯·æ±‚åå¯¹å“åº”åšåå¤„ç†ã€‚</p>
<p>Interceptor åœ¨è¯·æ±‚è¿›å…¥ Servletï¼Œä¸”åˆ°è¾¾ Controller ä¹‹å‰å¯¹è¯·æ±‚åšé¢„å¤„ç†ï¼›åœ¨ Controller å¤„ç†å®Œè¯·æ±‚åå¯¹ ModelAndView åšåå¤„ç†ï¼Œåœ¨è§†å›¾æ¸²æŸ“å®Œæˆåå†åšä¸€äº›æ”¶å°¾å·¥ä½œã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†äºŒè€…çš„è§¦å‘æ—¶æœºï¼š</p>
<p><img src="https://johnlearning.oss-cn-beijing.aliyuncs.com/blog/technology/Filter_Interceptor/%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E5%8E%9F%E7%90%86.jpg" alt></p>
<p>å½“ Filter å’Œ Interceptor åŒæ—¶å­˜åœ¨æ—¶ï¼ŒFilter å¯¹è¯·æ±‚çš„é¢„å¤„ç†è¦å…ˆäº Interceptor çš„ preHandle æ–¹æ³•ï¼›Filter å¯¹å“åº”çš„åå¤„ç†è¦åäº Interceptor çš„ postHandle æ–¹æ³•å’Œ afterCompletion æ–¹æ³•ã€‚</p>
<h2 id="å…³äº-Filter-å’Œ-Interceptor-çš„è¡¥å……è¯´æ˜"><a href="#å…³äº-Filter-å’Œ-Interceptor-çš„è¡¥å……è¯´æ˜" class="headerlink" title="å…³äº Filter å’Œ Interceptor çš„è¡¥å……è¯´æ˜"></a>å…³äº Filter å’Œ Interceptor çš„è¡¥å……è¯´æ˜</h2><p><strong>1. åœ¨ Filter å’Œ Interceptor æ³¨å…¥ Bean çš„æ³¨æ„äº‹é¡¹</strong></p>
<p>æœ‰äº›æ–‡ç« åœ¨ä»‹ç» Filter å’Œ Interceptor çš„åŒºåˆ«æ—¶å¼ºè°ƒ Filter ä¸èƒ½é€šè¿‡ IoC æ³¨å…¥ Beanï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨æœ¬æ–‡ä¸­çš„ç¬¬ä¸€ç§åˆ›å»º Filterï¼Œé‚£ä¹ˆç¡®å®ä¸èƒ½æ³¨å…¥æˆåŠŸï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// è‡ªå®šä¹‰çš„ Filter, æœªæ·»åŠ  @Component æ³¨è§£</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> UserService userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span>ServletRequest servletRequest<span class="token punctuation">,</span> ServletResponse servletResponse<span class="token punctuation">,</span> FilterChain filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>
        HttpServletRequest request <span class="token operator">=</span> <span class="token punctuation">(</span>HttpServletRequest<span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// é…ç½®ç±»</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> FilterRegistrationBean<span class="token operator">&lt;</span>TestFilter<span class="token operator">></span> <span class="token function">registryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        FilterRegistrationBean<span class="token operator">&lt;</span>TestFilter<span class="token operator">></span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">addUrlPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"TestFilter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šè¿°ä»£ç æ‰§è¡Œåï¼ŒuserService è¾“å‡ºä¸º nullï¼Œå› ä¸ºæ³¨å†Œåˆ° IoC å®¹å™¨ä¸­çš„æ˜¯ new å‡ºæ¥çš„ä¸€ä¸ª TestFilter å¯¹è±¡ï¼ˆ<code>registration.setFilter(new TestFilter());</code>ï¼‰ï¼Œå¹¶ä¸æ˜¯ Spring è‡ªåŠ¨è£…é…çš„ã€‚è‹¥è¦ä½¿ userService æ³¨å…¥æˆåŠŸï¼Œå¯æ”¹ä¸ºå¦‚ä¸‹å†™æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// è‡ªå®šä¹‰çš„ Filter, æœªæ·»åŠ  @Component æ³¨è§£</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> UserService userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span>ServletRequest servletRequest<span class="token punctuation">,</span> ServletResponse servletResponse<span class="token punctuation">,</span> FilterChain filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>
        HttpServletRequest request <span class="token operator">=</span> <span class="token punctuation">(</span>HttpServletRequest<span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// é…ç½®ç±»</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> TestFilter testFilter<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> FilterRegistrationBean<span class="token operator">&lt;</span>TestFilter<span class="token operator">></span> <span class="token function">registryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        FilterRegistrationBean<span class="token operator">&lt;</span>TestFilter<span class="token operator">></span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>testFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">addUrlPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"TestFilter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registration<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸ç¬¬ä¸€ç§å†™æ³•çš„åŒºåˆ«åœ¨äºï¼ŒTestFilter ç±»ä¸Šæ·»åŠ äº† @Component æ³¨è§£ï¼Œä¸”é…ç½®ç±»ä¸­é€šè¿‡ @Autowired æ³¨å…¥ TestFilter å¯¹è±¡ã€‚é™¤äº†ä½¿ç”¨é…ç½®ç±»å¤–ï¼Œæœ¬æ–‡ä»‹ç»çš„å…¶å®ƒå‡ ç§æ–¹å¼ï¼ˆæ·»åŠ  @Component æ³¨è§£æˆ– @WebFilter æ³¨è§£ï¼‰éƒ½å¯ä»¥ç›´æ¥æ³¨å…¥ Beanã€‚</p>
<blockquote>
<p>æ‰€ä»¥è¿˜æ˜¯é‡‡ç”¨ç»§æ‰¿ OncePerRequestFilter çš„æ–¹å¼åˆ›å»º Filter æ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
</blockquote>
<p>å¦å¤–ï¼Œä½¿ç”¨æœ¬æ–‡ä»‹ç»çš„åˆ›å»º Interceptor çš„å†™æ³•æ˜¯å¯ä»¥ç›´æ¥æ³¨å…¥ Bean çš„ï¼Œè¯¥å†™æ³•ä¹Ÿæ˜¯å…ˆåœ¨è‡ªå®šä¹‰çš„ Interceptor ä¸Šæ·»åŠ  @Component æ³¨è§£ï¼Œç„¶ååœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ @Autowired æ³¨å…¥è‡ªå®šä¹‰çš„ Interceptorã€‚</p>
<p><strong>2. Interceptor å¯ä»¥æ‹¦æˆªé™æ€è¯·æ±‚</strong></p>
<p>æœ‰æ–‡ç« æåˆ° Interceptor ä¸èƒ½æ‹¦æˆªé™æ€è¯·æ±‚ï¼Œå…¶å®åœ¨ Spring 1.x çš„ç‰ˆæœ¬ä¸­ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œä½† Spring 2.x å¯¹é™æ€èµ„æºä¹Ÿè¿›è¡Œäº†æ‹¦æˆªï¼Œä¾‹å¦‚ä¸Šæ–‡ä¸­æˆ‘ä»¬åœ¨æµ‹è¯• TestInterceptor æ˜¯å¦ç”Ÿæ•ˆæ—¶ï¼Œå‘ç°å…¶æ‹¦æˆªåˆ°äº† <code>/favicon.ico</code> è¯·æ±‚ï¼Œè¯¥è¯·æ±‚æ˜¯ä¸€ä¸ªç”±æµè§ˆå™¨è‡ªåŠ¨å‘é€çš„é™æ€è¯·æ±‚ã€‚</p>
<p><strong>3. Interceptor ä¸æ˜¯åŸºäº Java çš„åå°„æœºåˆ¶ï¼ˆåŠ¨æ€ä»£ç†ï¼‰æ¥å®ç°çš„</strong></p>
<p>è¯¦è§ä¸Šæ–‡ä¸­ Interceptor çš„å®ç°åŸç†ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>ä¹¦ç±ï¼šã€ŠJava web æ•´åˆå¼€å‘ç‹è€…å½’æ¥ã€‹<br><a href="https://www.cnblogs.com/paddix/p/8365558.html" target="_blank" rel="noopener">Spring Boot å®æˆ˜ï¼šæ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨</a><br><a href="https://juejin.cn/post/6844904179958284301" target="_blank" rel="noopener">è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„ 6 ä¸ªåŒºåˆ«ï¼Œåˆ«å†å‚»å‚»åˆ†ä¸æ¸…äº†</a></p>

            </div>
            <hr />

            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #e6c5c4;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }

    img[src=""],img:not([src]){
        opacity:0;
    }
</style>



    <!-- <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>è½¬è½½è§„åˆ™</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    ã€ŠèŠä¸€èŠè¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨ã€‹
                </span> ç”±
            <a xmlns:cc="http://creativecommons.org/ns#" href="/liao-yi-liao-guo-lu-qi-yu-lan-jie-qi.html" property="cc:attributionName"
               rel="cc:attributionURL">
                JohnåŒå­¦
            </a> é‡‡ç”¨
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                çŸ¥è¯†å…±äº«ç½²å 4.0 å›½é™…è®¸å¯åè®®
            </a>è¿›è¡Œè®¸å¯ã€‚
        
    </div> -->

    <div class="reprint" id="reprint-statement">
        
        <div class="reprint__author">
            <span class="reprint-meta">
                <i class="fa fa-user" style="font-weight: bold;">
                    ä½œè€…:
                </i>
            </span>
            <span class="reprint-info">
                æœ¬æ–‡ç”±
                <a href="https://mrjohnzh.github.io" rel="external nofollow noreferrer">JohnåŒå­¦</a>
                åˆ›ä½œã€‚
            </span>
        </div>
        <!-- <div class="reprint__type">
            <span class="reprint-meta" style="font-weight: bold;">
                <i class="fa fa-link">
                    æ–‡ç« é“¾æ¥:
                </i>
            </span>
            <span class="reprint-info">
                <a href="https://javaguide.cn/2019/08/21/java/java%E5%9F%BA%E7%A1%80/BIO,NIO,AIO%20%E6%80%BB%E7%BB%93/">https://javaguide.cn/2019/08/21/java/java%E5%9F%BA%E7%A1%80/BIO,NIO,AIO%20%E6%80%BB%E7%BB%93/</a>
            </span>
        </div> -->
        <div class="reprint__notice">
            <span class="reprint-meta">
                <i class="fa fa-copyright" style="font-weight: bold;">
                    ç‰ˆæƒå£°æ˜:
                </i>
            </span>
            <span class="reprint-info">
                æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜æ¥æºï¼
            </span>
        </div>

        <div class="reprint__type">
            <span class="reprint-meta">
                <i class="fa fa-thumbs-up" style="font-weight: bold;">
                    <!-- æ±‚æ‰“èµ: -->
                    æ±‚å…³æ³¨: 
                </i>
            </span>
            <span class="reprint-info">
                <!-- å†™ä½œä¸æ˜“ï¼Œå®¢å®˜èƒ½å¦æ‰“èµä¸€æ¯å¥¶èŒ¶ -->
                å†™ä½œä¸æ˜“ï¼Œå®¢å®˜èƒ½å¦ç‚¹ä¸ªå…³æ³¨
                <!-- <a href="#rewardModal" class="reward-link modal-trigger fa fa-coffee"></a> -->
                <a class="fa fa-heart" onmouseover="on()" onmouseout="off()"></a>
                æ”¯æŒä¸€ä¸‹ã€‚
            </span>

            <!-- Modal Structure -->
            <!-- <div id="rewardModal" class="modal">
                <div class="modal-content">
                    <a class="close modal-close"><i class="fa fa-close"></i></a>
                    <h4 class="reward-title"></h4>
                    <div class="reward-content">
                        <div class="reward-tabs">
                            <ul class="tabs row">
                                <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                                <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                            </ul>
                            <div id="alipay">
                                <img src="/medias/reward/alipay.jpg" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                            </div>
                            <div id="wechat">
                                <img src="/medias/reward/wechat.jpg" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                            </div>
                        </div>
                    </div>
                </div>
            </div> -->
        </div>
        
        <!-- <div class="social-share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
            <div class="social-share" data-sites="twitter, facebook, qq, wechat" data-wechat-qrcode-helper=""></div>
        </div> -->
    </div>
    <body>
        <img id="s" src=""/>
    </body>


    <script>
        function on() {
            $("#s").attr("src", "https://cdn.jsdelivr.net/gh/mrjohnzh/Common@1.2/imgs/%E5%85%AC%E4%BC%97%E5%8F%B7JohnLearning.png");
            $(document).mousemove(function(e) {
                // $("#s").css("position", "absolute").css("left", e.pageX+1+"px").css("top", e.pageY+1+"px");
                $("#s").css("position", "absolute").css("left", e.pageX-285+"px").css("top", e.pageY-500+"px");
            })
        }
    
        /**
         * å…³é—­å›¾ç‰‡, å½“é¼ æ ‡ç§»å‡ºæ—¶æ‰§è¡Œ
         */
        function off() {
            $("#s").attr("src", "");
            $(document).mousemove(function(e) {
                $("#s").css("position", "absolute").css("left", "-400px").css("top", "-400px");
            })
        }
    </script>

    
    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
    <script src="/libs/share/js/social-share.min.js"></script>
    

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span style="font-family: KaiTi">å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller; font-family: KaiTi">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>

    <script>
        $(function () {
            $('.tabs').tabs();
        });
    </script>



        </div>
    </div>

    

    

    

    
    <div class="livere-card card" data-aos="fade-up">
    <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
    <div id="lv-container" data-id="city" data-uid="MTAyMC81NDY2NS8zMTEzNg==">
        <script type="text/javascript">
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
    })(document, 'script');
        </script>
    <noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
    </div>
    <!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
</div>
    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/fastjson-jackjson-yi-ji-gson-de-qu-bie.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/28.jpg" class="responsive-img" alt="FastJsonã€JackJson ä»¥åŠ Gson çš„åŒºåˆ«">
                        
                        <span class="card-title">FastJsonã€JackJson ä»¥åŠ Gson çš„åŒºåˆ«</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            FastJsonã€JackJson ä»¥åŠ Gson æ˜¯ Java ç”Ÿæ€åœˆä¸­ä¸‰ç§å¸¸ç”¨çš„ Json è§£æå™¨ï¼Œå®ƒä»¬å‡å¯å°† Java å¯¹è±¡åºåˆ—åŒ–ä¸º Json æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯å°† Json å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ã€‚ä¸‹é¢æˆ‘ä»¬è®¨è®ºä¸€ä¸‹ä¸‰è€…åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œä¸­çš„ä¸€äº›åŒºåˆ«ã€‚
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2022-06-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/éšç¬”/" class="post-category" target="_blank">
                                    éšç¬”
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/åç«¯/" target="_blank">
                        <span class="chip bg-color">åç«¯</span>
                    </a>
                    
                    <a href="/tags/Java/" target="_blank">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/Json/" target="_blank">
                        <span class="chip bg-color">Json</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/mvc-he-san-ceng-jia-gou.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="MVC å’Œä¸‰å±‚æ¶æ„">
                        
                        <span class="card-title">MVC å’Œä¸‰å±‚æ¶æ„</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            MVC å’Œä¸‰å±‚æ¶æ„éƒ½æ˜¯ç›®å‰éå¸¸æµè¡Œçš„å¼€å‘æ¨¡å¼ï¼Œä½œä¸ºåç«¯å¼€å‘äººå‘˜ï¼Œå¾ˆæœ‰å¿…è¦äº†è§£ä¸€ä¸‹äºŒè€…çš„è®¾è®¡ç†å¿µã€‚ä¸ºæ­¤ï¼Œæœ¬æ–‡ä¼šå¯¹ MVC å’Œä¸‰å±‚æ¶æ„åšä¸€ä¸ªç®€å•çš„æ¦‚è¿°ã€‚
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2022-05-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/æŠ€æœ¯å­¦ä¹ /" class="post-category" target="_blank">
                                    æŠ€æœ¯å­¦ä¹ 
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/" target="_blank">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/Web/" target="_blank">
                        <span class="chip bg-color">Web</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- ä»£ç è¯­è¨€ -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- ä»£ç å—å¤åˆ¶ -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- ä»£ç å—æ”¶ç¼© -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- ä»£ç å—æŠ˜è¡Œ -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
       <div class="Copy-right">
            &copy; 2021 JohnåŒå­¦. All Rights Reserved.</br>

                    
           <!--<a href="/sitemap.xml" target="_blank">ç«™ç‚¹åœ°å›¾</a>ä¸¨-->
           <!-- 
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;
            <span class="white-color">34.4k
             ä¸¨             -->
          

            <span id="sitetime"></span>

            
            
             
            
            </br><span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-users"></i>
            æ€»è®¿é—®é‡: <span id="busuanzi_value_site_pv" class="red-color"></span>
            æ¬¡</span>  &nbsp;|&nbsp;
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>&nbsp;<i class="fa fa-user"></i>
                æ€»è®¿é—®äººæ•°: <span id="busuanzi_value_site_uv" class="blue-color"></span>&nbsp;äºº
            </span>
            
            
        </div>        
    </div>
    <!-- <div class="container row center-align">
    <div class="github-badge">
      <a style="color: #fff" rel="license" href="https://hexo.io/" target="_blank" title="ç”± Hexo å¼ºåŠ›é©±åŠ¨">
      <span class="badge-subject">Powered</span><span class="badge-value bg-blue">Hexo</span></a>
    </div> -->
    <!-- <div class="github-badge">
      <a style="color: #fff" rel="license" href="https://github.com/" target="_blank" title="é™æ€ç½‘é¡µæ‰˜ç®¡äº GitHub Pages å’Œ Coding Pages">
      <span class="badge-subject">Hosted</span><span class="badge-value bg-brightgreen">GitHub & Coding</span></a>
    </div> -->
    <!-- <div class="github-badge">
      <a style="color: #fff" rel="license" href="https://www.cloud.tencent.com/" target="_blank" title="è…¾è®¯äº‘æä¾›åŸŸåç›¸å…³æœåŠ¡">
      <span class="badge-subject">DNS</span><span class="badge-value bg-blueviolet">Tencent cloud</span></a>
    </div> -->
    <!-- <div class="github-badge">
      <a style="color: #fff" rel="license" href="https://www.jsdelivr.com/" target="_blank" title="jsDelivr æä¾› CDN åŠ é€ŸæœåŠ¡">
      <span class="badge-subject">CDN</span><span class="badge-value bg-orange">jsDelivr</span></a>
    </div> -->
    <!-- <div class="github-badge">
        <a style="color: #fff" rel="license" href="https://github.com/blinkfox/hexo-theme-matery/" target="_blank" title="ç«™ç‚¹ä½¿ç”¨ Matery ä¸»é¢˜">
      <span class="badge-subject">Theme</span><span class="badge-value bg-blue">Matery</span></a>
    </div> -->
    <!-- <div class="github-badge">
      <a style="color: #fff" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="æœ¬ç«™ç‚¹é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯">
      <span class="badge-subject"><i class="fa fa-copyright"></i></span><span class="badge-value bg-lightgrey">BY-NC-SA 4.0</span></a>
    </div> -->
    <!-- <div class="github-badge">
      <a style="color: #fff" rel="license" href="https://996.icu/" target="_blank" title="æ”¯æŒ 996.ICU">
      <span class="badge-subject">Link</span><span class="badge-value bg-red">996.ICU</span></a>
    </div> -->
    <!-- <div class="github-badge">
      <span class="badge-subject">UV</span><span class="badge-value bg-orange" id="busuanzi_value_site_uv"></span>
    </div> -->
    <!-- <div class="github-badge">
      <span class="badge-subject">PV</span><span class="badge-value bg-brightgreen" id="busuanzi_value_site_pv"></span>
    </div>
    <div class="github-badge">
      <span class="badge-subject">WordCount</span><span class="badge-value bg-blueviolet">34.4k</span>
    </div> -->
</footer>


<!-- ä¸è’œå­è®¡æ•°åˆå§‹å€¼çº æ­£ -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 0;
        var uvcountOffset = 0;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // åŠ ä¸Šåˆå§‹æ•°æ® 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
        year - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
        month - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
        day - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
        hours - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
        minutes - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
        seconds - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
        microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•° */
        var t1 = Date.UTC(2021, 09, 17, 00, 00, 00); //åŒ—äº¬æ—¶é—´2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²è¿è¡Œ " + diffYears + " å¹´ " + diffDays + " å¤© " + diffHours + " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
    }
    siteTime();
</script>

    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- <script type="text/javascript"> 
    var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Î£(ã£ Â°Ğ” Â°;)ã£å–”å“Ÿï¼Œå´©æºƒå•¦ï¼", clearTimeout(st)) : (document.title = "Ï†(ã‚œâ–½ã‚œ*)â™ªå’¦ï¼Œåˆå¥½äº†ï¼", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script> -->

    <!-- Global site tag (gtag.js) - Google Analytics -->



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- é›ªèŠ±ç‰¹æ•ˆ -->
    

   <!--å•å‡»æ˜¾ç¤ºæ–‡å­—-->
   <script type="text/javascript" src="/js/click_show_text.js"></script> 

   <!--åŠ¨æ€çº¿æ¡èƒŒæ™¯-->
   <script type="text/javascript"
   color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
   </script>

   <!-- <script async src ="https://cdn.jsdelivr.net/npm/perfops-rom"> </script> -->

   <!--è‡ªå®šä¹‰çœ‹æ¿å¨˜-->
   <!-- <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script> -->
   <!-- <script src="/live2d-widget/autoload.js"></script> -->
   <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/> -->

</body>

</html>